<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Correção de Gabarito</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid black;
      padding: 10px;
      text-align: center;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
    }
    #gabaritoForm {
      max-width: 400px;
    }
    #qr-reader {
      width: 100%;
      max-width: 300px;
      margin: 20px auto;
      display: none;
    }
    #inputQRCode {
      width: 60%;
      padding: 10px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
  <!-- Adicionando a biblioteca html5-qrcode -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
</head>
<body>

  <h1>Seleção de Alternativas</h1>

  <form id="gabaritoForm">
    <table id="gabarito">
      <!-- Questões e alternativas serão inseridas aqui -->
    </table>

    <label for="codigoRespostas">Código de Respostas (Exemplo: 243653148862):</label><br>
    <input type="text" id="codigoRespostas" placeholder="Insira o código" readonly>
    <button type="button" id="startScan">Ler QR Code</button><br><br>

    <button type="button" onclick="corrigirGabarito()">Corrigir</button>
  </form>

  <div id="qr-reader"></div>

  <div id="result"></div>

  <script>
    // Chave para correção
    const chave = [0, 1, 2, 2, 2, 1, 0, 2, 4, 4, 3, 1]; // Índices corretos
    const numeroDeQuestoes = chave.length; // Total de questões

    // Função que cria a tabela de gabarito
    function criaGabarito() {
      const gabarito = document.getElementById('gabarito');

      // Cabeçalhos da tabela
      const tr = document.createElement('tr');
      const th = document.createElement('th');
      th.innerHTML = "Questão";
      tr.appendChild(th);
      for (let i = 0; i < 4; i++) {
        const th = document.createElement('th');
        th.innerHTML = String.fromCharCode(65 + i); // A, B, C, D
        tr.appendChild(th);
      }
      gabarito.appendChild(tr);

      // Linhas para as alternativas
      for (let i = 0; i < numeroDeQuestoes; i++) {
        const tr = document.createElement('tr');
        const th = document.createElement('th');
        th.innerHTML = `Q ${i + 1}`;
        tr.appendChild(th);

        for (let j = 0; j < 4; j++) {
          const td = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = `questao${i}`; // O name é único para cada questão
          input.value = j + 1; // Valor da alternativa
          td.appendChild(input);
          tr.appendChild(td);
        }

        gabarito.appendChild(tr);
      }
    }

    criaGabarito(); // Gera a tabela de perguntas e alternativas

    // Função que corrige o gabarito
    function corrigirGabarito() {
      const respostasSelecionadas = [];

      // Obtém as alternativas selecionadas
      for (let i = 0; i < numeroDeQuestoes; i++) {
        const alternativaSelecionada = document.querySelector(`input[name="questao${i}"]:checked`);
        if (alternativaSelecionada) {
          respostasSelecionadas.push(parseInt(alternativaSelecionada.value));
        } else {
          respostasSelecionadas.push(null); // Se não houver seleção, coloca null
        }
      }

      // Obtém o código de respostas inserido pelo usuário
      const codigoRespostas = document.getElementById('codigoRespostas').value;
      const respostaCorreta = Array.from(codigoRespostas).map(Number); // Converte para vetor de números
      
      // Subtrai a chave do vetor respostaCorreta para obter o vetor comparativo
      const respostaComparativa = respostaCorreta.map((resposta, index) => resposta - chave[index]);
      
      // Verifica os acertos
      let acertos = 0;
      for (let i = 0; i < numeroDeQuestoes; i++) {
        if (respostasSelecionadas[i] === respostaComparativa[i]) {
          acertos++;
        }
      }

      // Exibe o resultado
      document.getElementById('result').innerHTML = `Você acertou ${acertos} de ${numeroDeQuestoes} questões.`;
    }

    // Função para iniciar o leitor de QR Code
    let qrCodeReader;

    document.getElementById('startScan').addEventListener('click', () => {
      const qrReaderElement = document.getElementById('qr-reader');
      qrReaderElement.style.display = 'block'; // Exibe o div de leitura

      if (!qrCodeReader) {
        qrCodeReader = new Html5Qrcode("qr-reader");
      }

      qrCodeReader.start(
        { facingMode: "environment" }, // Preferencialmente usa a câmera traseira em dispositivos móveis
        {
          fps: 10, // Frames por segundo para escaneamento
          qrbox: 250 // Tamanho da caixa de escaneamento
        },
        (decodedText) => {
          // Quando o QR code é lido com sucesso, insere o valor no input
          document.getElementById('codigoRespostas').value = decodedText;
          qrCodeReader.stop(); // Para o leitor de QR code após leitura
          qrReaderElement.style.display = 'none'; // Esconde o leitor após leitura
        },
        (errorMessage) => {
          console.log(`Erro de leitura: ${errorMessage}`);
        }
      ).catch((err) => {
        console.error(`Erro ao iniciar a leitura do QR Code: ${err}`);
      });
    });
  </script>

</body>
</html>